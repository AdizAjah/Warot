<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="icon" href="WAROT LOGO.png">
    
    <title>WAROT</title>
    <style>
        body {
            margin: 0;
            background-color: #000;
            font-family: 'Consolas', 'Courier New', monospace;
            color: #fff;
            user-select: none;
            overflow: hidden; 
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* --- CONTAINER GAME --- */
        #game-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            flex-grow: 1; 
            background: #0a0a0a;
            overflow: hidden;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
        }
        
        canvas { 
            display: block; 
            width: 100%;
            height: 100%;
        }

        /* --- UI LAYER --- */
        #ui-layer {
            position: absolute;
            top: 10px; left: 10px;
            pointer-events: none;
            z-index: 10;
        }
        .stat-box {
            background: rgba(0, 0, 0, 0.5);
            border-left: 2px solid #fff;
            padding: 4px 10px;
            margin-bottom: 3px;
            font-size: 14px; 
            text-shadow: 1px 1px 0 #000;
        }

        /* --- MOBILE CONTROLS --- */
        #mobile-controls {
            display: none; 
            height: 160px; 
            background: #111;
            border-top: 2px solid #333;
            flex-shrink: 0;
            position: relative;
            touch-action: none;
        }

        .ctrl-zone {
            width: 50%;
            height: 100%;
            position: absolute;
            top: 0;
        }
        #zone-left { left: 0; border-right: 1px solid #222; }
        #zone-right { right: 0; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 10px; }

        /* ANALOG STICK */
        #joystick-base {
            width: 90px; height: 90px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
        }
        #joystick-knob {
            width: 35px; height: 35px;
            background: cyan;
            border-radius: 50%;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px cyan;
            pointer-events: none;
        }

        /* BUTTONS */
        .mob-btn {
            width: 55px; height: 55px;
            border-radius: 50%;
            border: 2px solid #fff;
            font-weight: bold;
            font-size: 10px;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            user-select: none;
            background: #222;
        }
        .mob-btn:active { background: #444; transform: scale(0.95); }
        
        #btn-atk { background: #900; width: 75px; height: 75px; font-size: 12px; margin-right: 5px; border-color: #f55;}
        #btn-swap { background: #009; border-color: #55f;}
        #btn-ulti { background: #606; color: yellow; border-color: yellow; }

        /* --- RESPONSIVE ADJUSTMENTS --- */
        @media (max-width: 800px) {
            #mobile-controls { display: block; }
            #game-wrapper {
                margin: 2px;
                width: calc(100% - 4px);
                border: 1px solid #333;
                border-radius: 4px;
            }
            .stat-box { font-size: 16px; padding: 5px 10px;}
            #polarity-hud {
                bottom: 10px !important; 
                transform: translateX(-50%) scale(0.7); 
                padding: 5px 15px;
            }
        }

        /* --- EFFECT LAYERS --- */
        #damage-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 5;
            background: radial-gradient(circle, transparent 60%, rgba(255, 0, 0, 0.4) 100%);
            opacity: 0; transition: opacity 1s;
        }
        .pulse-warning { animation: pulse-red 2s infinite ease-in-out; }
        @keyframes pulse-red { 0% { opacity: 0.1; } 50% { opacity: 0.4; } 100% { opacity: 0.1; } }

        /* --- ULTI READY OVERLAY (NEW) --- */
        #ulti-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 6; /* Di atas damage overlay sedikit */
            background: radial-gradient(circle, transparent 50%, rgba(180, 0, 255, 0.3) 100%);
            opacity: 0; transition: opacity 0.5s;
        }
        .pulse-ulti { animation: pulse-purple 1.5s infinite ease-in-out; }
        @keyframes pulse-purple { 0% { opacity: 0.1; } 50% { opacity: 0.5; } 100% { opacity: 0.1; } }

        #ulti-container {
            margin-top: 5px; width: 150px; height: 6px;
            background: #222; border: 1px solid #444; position: relative;
        }
        #ulti-fill { width: 0%; height: 100%; background: linear-gradient(90deg, #aa0, #a0a); transition: width 0.1s; }
        #ulti-text {
            position: absolute; top: -15px; left: 0;
            font-size: 10px; color: #f0f; /* Ubah ke Ungu/Magenta biar matching */
            font-weight: bold; display: none;
            text-shadow: 0 0 5px black; animation: blink 0.5s infinite;
        }
        @keyframes blink { 50% { opacity: 0.5; } }

        #polarity-hud {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 15px; background: rgba(0,0,0,0.6);
            padding: 8px 20px; border-radius: 50px; border: 1px solid #444; z-index: 10;
        }
        .color-indicator {
            width: 25px; height: 25px; border-radius: 50%; border: 2px solid #555;
            opacity: 0.2; transition: all 0.2s;
        }
        .color-indicator.active { opacity: 1; transform: scale(1.2); box-shadow: 0 0 10px currentColor; border-color: #fff; }

        #message {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 30px; color: white; font-weight: 900; display: none;
            text-align: center; z-index: 20; text-shadow: 0 0 20px #f00; width: 100%;
        }
    </style>
</head>
<body>

<!-- GAME AREA WRAPPER -->
<div id="game-wrapper">
    <div id="damage-overlay"></div>
    <div id="ulti-overlay"></div> <!-- Layer Ungu Baru -->
    
    <div id="ui-layer">
        <!-- 2. LOGO SVG DI UI (Visual Game) -->
        <div class="logo-container">
            <svg width="120" height="40" viewBox="0 0 120 40">
                <!-- Glitch Effect Shadows -->
                <text x="5" y="30" font-family="Arial Black" font-size="30" fill="red" opacity="0.7">WAROT</text>
                <text x="-2" y="30" font-family="Arial Black" font-size="30" fill="blue" opacity="0.7">WAROT</text>
                <!-- Main Text -->
                <text x="0" y="30" font-family="Arial Black" font-size="30" fill="white">WAROT</text>
                <!-- Sword Decoration -->
                <path d="M5 35 L115 35" stroke="white" stroke-width="2" />
            </svg>
        </div>
        <div class="stat-box" style="border-color: lime;">HP: <span id="hp-display">100</span>%</div>
        <div class="stat-box" style="border-color: cyan;">SCORE: <span id="score-display">0</span></div>
        
        <div id="ulti-container">
            <div id="ulti-text">ULTIMATE READY!</div>
            <div id="ulti-fill"></div>
        </div>
    </div>

    <div id="polarity-hud">
        <div id="ind-red" class="color-indicator" style="background:rgb(255, 0, 0); color:red;"></div>
        <div id="ind-blue" class="color-indicator" style="background:blue; color:blue;"></div>
    </div>

    <div id="message">
        YOU DIED<br>
        <small style="font-size:16px; color:#aaa;">Reload to Restart</small>
    </div>

    <canvas id="gameCanvas"></canvas>
</div>

<!-- MOBILE CONTROLS AREA -->
<div id="mobile-controls">
    <div id="zone-left" class="ctrl-zone">
        <div id="joystick-base">
            <div id="joystick-knob"></div>
        </div>
    </div>
    <div id="zone-right" class="ctrl-zone">
        <div id="btn-swap" class="mob-btn">SWAP</div>
        <div id="btn-atk" class="mob-btn">ATK</div>
        <div id="btn-ulti" class="mob-btn">ULTI</div>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const damageOverlay = document.getElementById('damage-overlay');
    const ultiOverlay = document.getElementById('ulti-overlay'); // Ref overlay ungu
    const container = document.getElementById('game-wrapper');

    function resize() {
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
    }
    window.addEventListener('resize', resize);
    resize(); 

    // --- GAME CONFIGURATION ---
    const isMobile = window.innerWidth < 800;
    const SCALE = isMobile ? 0.6 : 1.0; 

    const player = {
        x: 0, y: 0, 
        size: 20 * SCALE, 
        speed: 5, 
        color: 'red', 
        hp: 100,
        attacking: false,
        attackDuration: 0,
        switchCooldown: false
    };

    setTimeout(() => {
        player.x = canvas.width / 2;
        player.y = canvas.height / 2;
    }, 100);

    let enemies = [];
    const particles = [];
    const texts = []; 
    
    let gameOver = false;
    let score = 0;
    let frameCount = 0;
    
    let ultiCharge = 0;
    const maxUlti = 20; 
    let ultiActive = false; 
    let ultiRadius = 0; 

    // --- INPUT ---
    const keys = { w: false, a: false, s: false, d: false, space: false, shift: false, e: false };

    window.addEventListener('keydown', (e) => {
        const k = e.key.toLowerCase();
        if(keys.hasOwnProperty(k) || k === ' ') keys[k === ' ' ? 'space' : k] = true;
        if(e.key === 'Shift') keys.shift = true;
    });
    window.addEventListener('keyup', (e) => {
        const k = e.key.toLowerCase();
        if(keys.hasOwnProperty(k) || k === ' ') keys[k === ' ' ? 'space' : k] = false;
        if(e.key === 'Shift') keys.shift = false;
    });

    const joystickBase = document.getElementById('joystick-base');
    const joystickKnob = document.getElementById('joystick-knob');
    const zoneLeft = document.getElementById('zone-left');
    let stickInput = { x: 0, y: 0 };
    let touchId = null;

    zoneLeft.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const touch = e.changedTouches[0];
        touchId = touch.identifier;
        updateJoystick(touch.clientX, touch.clientY);
    }, {passive: false});

    zoneLeft.addEventListener('touchmove', (e) => {
        e.preventDefault();
        for (let i = 0; i < e.changedTouches.length; i++) {
            if (e.changedTouches[i].identifier === touchId) {
                updateJoystick(e.changedTouches[i].clientX, e.changedTouches[i].clientY);
                break;
            }
        }
    }, {passive: false});

    zoneLeft.addEventListener('touchend', (e) => {
        e.preventDefault();
        resetJoystick();
    });

    function updateJoystick(tx, ty) {
        const rect = joystickBase.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top + rect.height / 2;
        let dx = tx - cx; let dy = ty - cy;
        const dist = Math.sqrt(dx*dx + dy*dy);
        const max = rect.width / 2;
        if (dist > max) {
            const angle = Math.atan2(dy, dx);
            dx = Math.cos(angle) * max; dy = Math.sin(angle) * max;
        }
        joystickKnob.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
        stickInput.x = dx / max; stickInput.y = dy / max;
    }

    function resetJoystick() {
        joystickKnob.style.transform = `translate(-50%, -50%)`;
        stickInput.x = 0; stickInput.y = 0; touchId = null;
    }

    function bindTouchBtn(id, keyName) {
        const btn = document.getElementById(id);
        btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[keyName] = true; btn.style.opacity = "0.5"; btn.style.transform = "scale(0.9)"; }, {passive: false});
        btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[keyName] = false; btn.style.opacity = "1"; btn.style.transform = "scale(1)"; });
    }
    bindTouchBtn('btn-atk', 'space'); bindTouchBtn('btn-swap', 'shift'); bindTouchBtn('btn-ulti', 'e');

    // --- LOGIC ---
    function spawnEnemy() {
        const spawnRate = Math.max(15, 60 - (score * 0.5)); 
        if (frameCount % Math.floor(spawnRate) === 0) {
            const angle = Math.random() * Math.PI * 2;
            const dist = Math.max(canvas.width, canvas.height) / 1.1 + 50; 
            const type = Math.random() > 0.5 ? 'red' : 'blue';
            const baseEnemySize = 15 + Math.random() * 10;
            
            enemies.push({
                x: player.x + Math.cos(angle) * dist,
                y: player.y + Math.sin(angle) * dist,
                size: baseEnemySize * SCALE, 
                speed: 2 + (score * 0.015), 
                color: type
            });
        }
    }

    function spawnText(x, y, text, color) {
        texts.push({x, y, text, color, life: 30, dy: -1});
    }

    function addUltiCharge(amount) {
        ultiCharge = Math.min(maxUlti, ultiCharge + amount);
        updateUltiUI();
    }

    function updateUltiUI() {
        const pct = (ultiCharge / maxUlti) * 100;
        document.getElementById('ulti-fill').style.width = pct + '%';
        
        if(ultiCharge >= maxUlti) {
            document.getElementById('ulti-text').style.display = 'block';
            document.getElementById('btn-ulti').style.boxShadow = '0 0 15px #f0f'; // Glow ungu di tombol
            // Trigger visual ungu di layar
            if (!ultiOverlay.classList.contains('pulse-ulti')) {
                ultiOverlay.classList.add('pulse-ulti');
            }
        } else {
            document.getElementById('ulti-text').style.display = 'none';
            document.getElementById('btn-ulti').style.boxShadow = 'none';
            // Matikan visual ungu
            ultiOverlay.classList.remove('pulse-ulti');
        }
    }

    function triggerUltimate() {
        if(ultiCharge < maxUlti) return;
        ultiCharge = 0; updateUltiUI(); ultiActive = true; ultiRadius = 0;
        enemies.forEach(e => { createParticles(e.x, e.y, 'purple', 8); score++; });
        enemies = [];
    }

    function update() {
        if (gameOver) return;
        frameCount++;
        spawnEnemy();

        let mx = 0, my = 0;
        if (keys.w) my = -1; if (keys.s) my = 1; if (keys.a) mx = -1; if (keys.d) mx = 1;
        if (Math.abs(stickInput.x) > 0.1) mx = stickInput.x;
        if (Math.abs(stickInput.y) > 0.1) my = stickInput.y;
        
        player.x += mx * player.speed;
        player.y += my * player.speed;
        player.x = Math.max(10, Math.min(canvas.width-10, player.x));
        player.y = Math.max(10, Math.min(canvas.height-10, player.y));

        if (keys.e) triggerUltimate();
        if (keys.shift && !player.switchCooldown) {
            player.color = player.color === 'red' ? 'blue' : 'red';
            player.switchCooldown = true;
            setTimeout(() => player.switchCooldown = false, 150); 
        }
        document.getElementById('ind-red').className = `color-indicator ${player.color === 'red' ? 'active' : ''}`;
        document.getElementById('ind-blue').className = `color-indicator ${player.color === 'blue' ? 'active' : ''}`;

        if (keys.space && !player.attacking) { player.attacking = true; player.attackDuration = 6; }
        if (player.attacking) player.attackDuration--;
        if (player.attackDuration <= 0) player.attacking = false;

        const attackRange = 60 * SCALE;

        for (let i = enemies.length - 1; i >= 0; i--) {
            let e = enemies[i];
            const dx = player.x - e.x; const dy = player.y - e.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            
            e.x += (dx / dist) * e.speed; e.y += (dy / dist) * e.speed;

            if (dist < player.size + e.size) {
                if(!ultiActive) {
                    player.hp -= 10;
                    createParticles(player.x, player.y, 'white', 4);
                    enemies.splice(i, 1);
                    continue; 
                }
            }
            
            if (player.attacking && dist < player.size + e.size + attackRange) {
                if (player.color === e.color) {
                    createParticles(e.x, e.y, e.color, 6);
                    enemies.splice(i, 1);
                    score++; addUltiCharge(1); 
                } else {
                    if (frameCount % 5 === 0) { 
                        player.hp -= 2; 
                        e.x -= (dx/dist) * 30; e.y -= (dy/dist) * 30; 
                    }
                }
            }
        }

        if (player.hp <= 20 && player.hp > 0) {
            if (!damageOverlay.classList.contains('pulse-warning')) damageOverlay.classList.add('pulse-warning');
        } else { damageOverlay.classList.remove('pulse-warning'); }

        if (ultiActive) {
            ultiRadius += 50; 
            if (ultiRadius > Math.max(canvas.width, canvas.height)) ultiActive = false;
        }

        particles.forEach((p, i) => { p.life--; p.x += p.vx; p.y += p.vy; if (p.life <= 0) particles.splice(i, 1); });
        texts.forEach((t, i) => { t.life--; t.y += t.dy; if (t.life <= 0) texts.splice(i, 1); });

        document.getElementById('hp-display').innerText = Math.max(0, Math.floor(player.hp));
        document.getElementById('score-display').innerText = score;

        if (player.hp <= 0) {
            gameOver = true;
            document.getElementById('message').style.display = 'block';
            damageOverlay.style.display = 'none'; 
            ultiOverlay.classList.remove('pulse-ulti');
        }
    }

    function createParticles(x, y, color, count) {
        for(let i=0; i<count; i++) {
            let pColor = color === 'red' ? '#f00' : (color === 'blue' ? '#00f' : (color==='purple'?'#f0f':'#fff'));
            particles.push({
                x: x, y: y,
                vx: (Math.random() - 0.5) * 10,
                vy: (Math.random() - 0.5) * 10,
                life: 15 + Math.random() * 5,
                color: pColor
            });
        }
    }

    function draw() {
        ctx.fillStyle = 'rgba(10, 10, 10, 0.4)'; 
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (ultiActive) {
            ctx.save();
            ctx.beginPath(); ctx.arc(player.x, player.y, ultiRadius, 0, Math.PI * 2);
            ctx.strokeStyle = `rgba(255, 0, 255, ${1 - (ultiRadius / Math.max(canvas.width, canvas.height))})`;
            ctx.lineWidth = 40; ctx.stroke();
            ctx.restore();
        }

        ctx.save(); ctx.translate(player.x, player.y);
        
        if (player.attacking) {
            ctx.beginPath(); ctx.arc(0, 0, player.size + (60 * SCALE), 0, Math.PI * 2);
            ctx.fillStyle = player.color === 'red' ? 'rgba(255, 0, 0, 0.5)' : 'rgba(0, 80, 255, 0.5)';
            ctx.fill();
        }
        
        ctx.beginPath(); ctx.arc(0, 0, player.size + 4, 0, Math.PI * 2);
        ctx.strokeStyle = player.color === 'red' ? '#ff4444' : '#4444ff';
        ctx.lineWidth = 2; ctx.stroke();
        ctx.fillStyle = '#eee'; ctx.fillRect(-player.size/2, -player.size/2, player.size, player.size);
        ctx.restore();

        enemies.forEach(e => {
            ctx.beginPath(); ctx.arc(e.x, e.y, e.size, 0, Math.PI * 2);
            ctx.fillStyle = e.color === 'red' ? '#800' : '#008'; ctx.fill();
            ctx.strokeStyle = '#aaa'; ctx.lineWidth = 1; ctx.stroke();
        });

        particles.forEach(p => { ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, 3, 3); });
        texts.forEach(t => { ctx.fillStyle = t.color; ctx.font = "bold 12px Courier New"; ctx.fillText(t.text, t.x, t.y); });

        requestAnimationFrame(() => { update(); draw(); });
    }

    document.getElementById('message').addEventListener('click', () => { if(gameOver) window.location.reload(); });
    draw();
</script>
</body>
</html>